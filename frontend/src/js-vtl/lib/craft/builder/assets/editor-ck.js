//(function(Crafty, window, $) {
function createHTMLElement(e){return document.createElementNS&&document.documentElement.namespaceURI!==null?document.createElementNS("http://www.w3.org/1999/xhtml",e):document.createElement(e)}function errorz(e,t,n){n=n||{OK:function(){$(this).dialog("close")}};$error.attr("title",e).dialog({draggable:!1,resizable:!1,modal:!0,buttons:n});$error.parent().children(":first").addClass("errorz");$error.find("div").html(t)}function guessType(e){var t=e.replace(/^\s+|\s+$/g,""),n=+t;return t.length===0?e:isNaN(n)?e==="true"?!0:e==="false"?!1:e:n}var $b={},glob=this,$window,CURRENT_ENTITY,CURRENT_SCENE,frame,CM,CRAFTY_SRC="../crafty.js",LINT_OPTIONS={evil:!0,forin:!0,sub:!0,css:!0,cap:!0,on:!0,fragment:!0,es5:!0,debug:!0,browser:!0},craft,COMPS={},ENTS={},CENTS={},ASSETS={},SCENES={},CURSOR="pointer",SETTINGS={stage:[550,440]},BASE;$(function(){function r(){var e=$window.height(),t,n;$editorcontainer.css("height",e-320);$stage.css("height",e-320);$workarea.css("height",e-320);t=$stage.width()-6;n=$stage.height();var r={"margin-left":$workarea.width()/2-$area.width()/2,"margin-top":$workarea.height()/2-$area.height()/2};$area.css(r)}var e,t,n;$("a").each(function(){e=$(this);t=e.attr("href");t&&(t=t.substr(1));$b[t]=e});$("*").each(function(){n=$(this).attr("id");if(n){n="$"+n.replace(/-/g,"");glob[n]=$(this)}});$window=$(window);window.onbeforeunload="Are you sure you want to leave?";CM=new CodeMirror(CodeMirror.replace($editor[0]),{height:"100%",parserfile:["tokenizejavascript.js","parsejavascript.js"],stylesheet:"codemirror/css/jscolors.css",path:"codemirror/js/",autoMatchParens:!0,lineNumbers:!0,tabMode:"shift",enterMode:"keep",electricChars:!1,textWrapping:!1,indentUnit:4});$control.tabs();$workbench.tabs({show:function(e,t){r();if(t.index===1)if(!CURRENT_ENTITY){console.log("GO AWAY");$(this).tabs("select",0)}else Editor.setCode();else{console.log(CM,CURRENT_ENTITY);if(CM&&CURRENT_ENTITY){console.log("SAVE CODE");CURRENT_ENTITY.actions=CM.getCode()}}}});r();$window.bind("resize",r);$workarea.bind("selectstart",function(){return!1});initButtons();COMPS=Crafty.components();Editor.update();Crafty.init(SETTINGS.stage[0],SETTINGS.stage[1])});var Editor=function(){return{update:function(){var e,t,n="",r;for(e in COMPS)n+="<li><a href='#"+e+"'><img src='assets/images/plugin.png'/> "+e+"</a></li>";$components.find("ul").html(n);n="";for(e in ENTS)n+="<li><a href='#"+e+"'><img src='assets/images/bullet.png'/> "+e+" <b>"+ENTS[e].comps+"</b></a></li>";$entities.find("ul").html(n);n="";for(e in SCENES)n+="<li><a href='#"+e+"'><img src='assets/images/world.png'/> "+e+"</a></li>";$scenes.find("ul").html(n);n="";for(e in ASSETS){r=ASSETS[e].type;n+="<li><a href='#"+e+"' class='"+r+"'><img src='assets/images/"+r+".png'/> "+e+"</a></li>"}$assets.find("ul").html(n)},setCode:function(){if(CURRENT_ENTITY){CM.setCode(CURRENT_ENTITY.actions);$current.text(CURRENT_ENTITY.name);$workbench.tabs("select",1)}},run:function(){function f(){craft=r.Crafty}frame&&$stage[0].removeChild(frame);frame=createHTMLElement("iframe");frame.src="javascript:;";frame.frameBorder=0;frame.style.border="0";frame.style.width="100%";frame.style.height="100%";frame.style.display="block";$stage.append(frame);$(frame).load(f);var t=CM.getCode(),n,r=frame.contentWindow,i=JSLINT(t,LINT_OPTIONS);if(!i){var s=0,o=JSLINT.errors,u=o.length,a;for(;s<u;s++){a=o[s];if(!a)continue;this.log("Line <var>"+a.line+"</var> Char <var>"+a.character+"</var>: <code>"+a.evidence+"</code> ... "+a.reason)}if(o[u-1]==null){$workbench.tabs("select",0);return}}n=['<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head>',"<script type='text/javascript' src='"+CRAFTY_SRC+"'></scr"+"ipt>","<script type='text/javascript'>"+t+"</scr"+"ipt>","</head><body style='margin:0;padding:0'></body></html>"];r.document.open();r.document.write(n.join(""));r.document.close()},extract:function(e){var t,n=e.components(),r=e.assets,i=e("*"),s=e._scenes;for(t in n)COMPS[t]=n[t];for(t in r)ASSETS[t]={type:Editor.media(t),obj:r[t]};for(t in i){if(!i.hasOwnProperty(t)||t==="length")continue;ENTS[t]=i[t];var o,u=[];for(o in i[t].__c)u.push(o);ENTS[t].comps=u.join(", ")}for(t in s)SCENES[t]=s[t]},alert:function(t,n,r){$alert.attr("title",t).dialog({draggable:!1,resizable:!1,modal:!0,buttons:r});$alerttext.text(n)},log:function(e){$consoletext[0].innerHTML+="<small>"+e+"</small>"},media:function(e){var t=e.substr(e.lastIndexOf(".")+1).toLowerCase();if(t==="wav"||t==="mp3"||t==="ogg"||t==="m4a")return"sound";if(t==="png"||t==="jpg"||t==="jpeg"||t==="gif"||t==="bmp")return"image";return}}}();window.Builder=Editor;