/* CodeMirror main module (http://codemirror.net/)
 *
 * Implements the CodeMirror constructor and prototype, which take care
 * of initializing the editor frame, and providing the outside interface.
 */// The CodeMirrorConfig object is used to specify a default
// configuration. If you specify such an object before loading this
// file, the values you put into it will override the defaults given
// below. You can also assign to it after loading.
var CodeMirrorConfig=window.CodeMirrorConfig||{},CodeMirror=function(){function e(e,t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}function t(e,t){for(var n=0;n<e.length;n++)t(e[n])}function n(e){return document.createElementNS&&document.documentElement.namespaceURI!==null?document.createElementNS("http://www.w3.org/1999/xhtml",e):document.createElement(e)}function r(e,t){var r=n("div"),i=n("div");r.style.position="absolute";r.style.height="100%";if(r.style.setExpression)try{r.style.setExpression("height","this.previousSibling.offsetHeight + 'px'")}catch(s){}r.style.top="0px";r.style.left="0px";r.style.overflow="hidden";e.appendChild(r);i.className="CodeMirror-line-numbers";r.appendChild(i);i.innerHTML="<div>"+t+"</div>";return r}function i(e){typeof e.parserfile=="string"&&(e.parserfile=[e.parserfile]);typeof e.basefiles=="string"&&(e.basefiles=[e.basefiles]);typeof e.stylesheet=="string"&&(e.stylesheet=[e.stylesheet]);var n=['<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head>'];n.push('<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7"/>');var r=e.noScriptCaching?"?nocache="+(new Date).getTime().toString(16):"";t(e.stylesheet,function(e){n.push('<link rel="stylesheet" type="text/css" href="'+e+r+'"/>')});t(e.basefiles.concat(e.parserfile),function(t){/^https?:/.test(t)||(t=e.path+t);n.push('<script type="text/javascript" src="'+t+r+'"><'+"/script>")});n.push('</head><body style="border-width: 0;" class="editbox" spellcheck="'+(e.disableSpellcheck?"false":"true")+'"></body></html>');return n.join("")}function o(t,o){this.options=o=o||{};e(o,CodeMirrorConfig);o.dumbTabs?o.tabMode="spaces":o.normalTab&&(o.tabMode="default");o.cursorActivity&&(o.onCursorActivity=o.cursorActivity);var u=this.frame=n("iframe");o.iframeClass&&(u.className=o.iframeClass);u.frameBorder=0;u.style.border="0";u.style.width="100%";u.style.height="100%";u.style.display="block";var a=this.wrapping=n("div");a.style.position="relative";a.className="CodeMirror-wrapping";a.style.width=o.width;a.style.height=o.height=="dynamic"?o.minHeight+"px":o.height;var f=this.textareaHack=n("textarea");a.appendChild(f);f.style.position="absolute";f.style.left="-10000px";f.style.width="10px";f.tabIndex=1e5;u.CodeMirror=this;if(o.domain&&s){this.html=i(o);u.src="javascript:(function(){document.open();"+(o.domain?'document.domain="'+o.domain+'";':"")+"document.write(window.frameElement.CodeMirror.html);document.close();})()"}else u.src="javascript:;";t.appendChild?t.appendChild(a):t(a);a.appendChild(u);o.lineNumbers&&(this.lineNumbers=r(a,o.firstLineNumber));this.win=u.contentWindow;if(!o.domain||!s){this.win.document.open();this.win.document.write(i(o));this.win.document.close()}}e(CodeMirrorConfig,{stylesheet:[],path:"",parserfile:[],basefiles:["util.js","stringstream.js","select.js","undo.js","editor.js","tokenize.js"],iframeClass:null,passDelay:200,passTime:50,lineNumberDelay:200,lineNumberTime:50,continuousScanning:!1,saveFunction:null,onLoad:null,onChange:null,undoDepth:50,undoDelay:800,disableSpellcheck:!0,textWrapping:!0,readOnly:!1,width:"",height:"300px",minHeight:100,autoMatchParens:!1,markParen:null,unmarkParen:null,parserConfig:null,tabMode:"indent",enterMode:"indent",electricChars:!0,reindentOnLoad:!1,activeTokens:null,onCursorActivity:null,lineNumbers:!1,firstLineNumber:1,onLineNumberClick:null,indentUnit:2,domain:null,noScriptCaching:!1,incrementalLoading:!1});var s=document.selection&&window.ActiveXObject&&/MSIE/.test(navigator.userAgent);o.prototype={init:function(){this.options.initCallback&&this.options.initCallback(this);this.options.onLoad&&this.options.onLoad(this);this.options.lineNumbers&&this.activateLineNumbers();this.options.reindentOnLoad&&this.reindent();this.options.height=="dynamic"&&this.setDynamicHeight()},getCode:function(){return this.editor.getCode()},setCode:function(e){this.editor.importCode(e)},selection:function(){this.focusIfIE();return this.editor.selectedText()},reindent:function(){this.editor.reindent()},reindentSelection:function(){this.focusIfIE();this.editor.reindentSelection(null)},focusIfIE:function(){this.win.select.ie_selection&&document.activeElement!=this.frame&&this.focus()},focus:function(){this.win.focus();this.editor.selectionSnapshot&&this.win.select.setBookmark(this.win.document.body,this.editor.selectionSnapshot)},replaceSelection:function(e){this.focus();this.editor.replaceSelection(e);return!0},replaceChars:function(e,t,n){this.editor.replaceChars(e,t,n)},getSearchCursor:function(e,t,n){return this.editor.getSearchCursor(e,t,n)},undo:function(){this.editor.history.undo()},redo:function(){this.editor.history.redo()},historySize:function(){return this.editor.history.historySize()},clearHistory:function(){this.editor.history.clear()},grabKeys:function(e,t){this.editor.grabKeys(e,t)},ungrabKeys:function(){this.editor.ungrabKeys()},setParser:function(e,t){this.editor.setParser(e,t)},setSpellcheck:function(e){this.win.document.body.spellcheck=e},setStylesheet:function(e){typeof e=="string"&&(e=[e]);var t={},n={},r=this.win.document.getElementsByTagName("link");for(var i=0,s;s=r[i];i++)if(s.rel.indexOf("stylesheet")!==-1)for(var o=0;o<e.length;o++){var u=e[o];if(s.href.substring(s.href.length-u.length)===u){t[s.href]=!0;n[u]=!0}}for(var i=0,s;s=r[i];i++)s.rel.indexOf("stylesheet")!==-1&&(s.disabled=!(s.href in t));for(var o=0;o<e.length;o++){var u=e[o];if(!(u in n)){var s=this.win.document.createElement("link");s.rel="stylesheet";s.type="text/css";s.href=u;this.win.document.getElementsByTagName("head")[0].appendChild(s)}}},setTextWrapping:function(e){if(e==this.options.textWrapping)return;this.win.document.body.style.whiteSpace=e?"":"nowrap";this.options.textWrapping=e;if(this.lineNumbers){this.setLineNumbers(!1);this.setLineNumbers(!0)}},setIndentUnit:function(e){this.win.indentUnit=e},setUndoDepth:function(e){this.editor.history.maxDepth=e},setTabMode:function(e){this.options.tabMode=e},setEnterMode:function(e){this.options.enterMode=e},setLineNumbers:function(e){if(e&&!this.lineNumbers){this.lineNumbers=r(this.wrapping,this.options.firstLineNumber);this.activateLineNumbers()}else if(!e&&this.lineNumbers){this.wrapping.removeChild(this.lineNumbers);this.wrapping.style.paddingLeft="";this.lineNumbers=null}},cursorPosition:function(e){this.focusIfIE();return this.editor.cursorPosition(e)},firstLine:function(){return this.editor.firstLine()},lastLine:function(){return this.editor.lastLine()},nextLine:function(e){return this.editor.nextLine(e)},prevLine:function(e){return this.editor.prevLine(e)},lineContent:function(e){return this.editor.lineContent(e)},setLineContent:function(e,t){this.editor.setLineContent(e,t)},removeLine:function(e){this.editor.removeLine(e)},insertIntoLine:function(e,t,n){this.editor.insertIntoLine(e,t,n)},selectLines:function(e,t,n,r){this.win.focus();this.editor.selectLines(e,t,n,r)},nthLine:function(e){var t=this.firstLine();for(;e>1&&t!==!1;e--)t=this.nextLine(t);return t},lineNumber:function(e){var t=0;while(e!==!1){t++;e=this.prevLine(e)}return t},jumpToLine:function(e){typeof e=="number"&&(e=this.nthLine(e));this.selectLines(e,0);this.win.focus()},currentLine:function(){return this.lineNumber(this.cursorLine())},cursorLine:function(){return this.cursorPosition().line},cursorCoords:function(e){return this.editor.cursorCoords(e)},activateLineNumbers:function(){function f(){if(e.offsetWidth==0)return;for(var n=e;n.parentNode;n=n.parentNode);if(!s.parentNode||n!=document||!t.Editor){try{c()}catch(r){}clearInterval(h);return}if(s.offsetWidth!=a){a=s.offsetWidth;e.parentNode.style.paddingLeft=a+"px"}}function l(){s.scrollTop=i.scrollTop||r.documentElement.scrollTop||0}function p(t){var r=o.firstChild.offsetHeight;if(r==0)return;var s=50+Math.max(i.offsetHeight,Math.max(e.offsetHeight,i.scrollHeight||0)),a=Math.ceil(s/r);for(var f=o.childNodes.length;f<=a;f++){var l=n("div");l.appendChild(document.createTextNode(t?String(f+u.options.firstLineNumber):"Â "));o.appendChild(l)}}function d(){function e(){p(!0);l()}u.updateNumbers=e;var n=t.addEventHandler(t,"scroll",l,!0),r=t.addEventHandler(t,"resize",e,!0);c=function(){n();r();u.updateNumbers==e&&(u.updateNumbers=null)};e()}function v(){function d(e,t){r||(r=o.appendChild(n("div")));h&&h(r,t,e);f.push(r);f.push(e);a=r.offsetHeight+r.offsetTop;r=r.nextSibling}function v(){for(var e=0;e<f.length;e+=2)f[e].innerHTML=f[e+1];f=[]}function m(){if(!o.parentNode||o.parentNode!=u.lineNumbers)return;var n=(new Date).getTime()+u.options.lineNumberTime;while(e){d(s++,e.previousSibling);for(;e&&!t.isBR(e);e=e.nextSibling){var i=e.offsetTop+e.offsetHeight;while(o.offsetHeight&&i-3>a){var f=a;d("&nbsp;");if(a<=f)break}}e&&(e=e.nextSibling);if((new Date).getTime()>n){v();y=setTimeout(m,u.options.lineNumberDelay);return}}while(r)d(s++);v();l()}function g(t){l();p(t);e=i.firstChild;r=o.firstChild;a=0;s=u.options.firstLineNumber;m()}function b(){y&&clearTimeout(y);u.editor.allClean()?g():y=setTimeout(b,200)}var e,r,s,a,f=[],h=u.options.styleNumbers;g(!0);var y=null;u.updateNumbers=b;var w=t.addEventHandler(t,"scroll",l,!0),E=t.addEventHandler(t,"resize",b,!0);c=function(){y&&clearTimeout(y);u.updateNumbers==b&&(u.updateNumbers=null);w();E()}}var e=this.frame,t=e.contentWindow,r=t.document,i=r.body,s=this.lineNumbers,o=s.firstChild,u=this,a=null;s.onclick=function(e){var t=u.options.onLineNumberClick;if(t){var n=(e||window.event).target||(e||window.event).srcElement,r=n==s?NaN:Number(n.innerHTML);isNaN(r)||t(r,n)}};var c=function(){};f();var h=setInterval(f,500);(this.options.textWrapping||this.options.styleNumbers?v:d)()},setDynamicHeight:function(){function u(){var t=0,s=r.lastChild,u;while(s&&n.isBR(s)){s.hackBR||t++;s=s.previousSibling}if(s){i=s.offsetHeight;u=s.offsetTop+(1+t)*i}else i&&(u=t*i);u&&(e.wrapping.style.height=Math.max(o+u,e.options.minHeight)+"px")}var e=this,t=e.options.onCursorActivity,n=e.win,r=n.document.body,i=null,s=null,o=2*e.frame.offsetTop;r.style.overflowY="hidden";n.document.documentElement.style.overflowY="hidden";this.frame.scrolling="no";setTimeout(u,300);e.options.onCursorActivity=function(e){t&&t(e);clearTimeout(s);s=setTimeout(u,100)}}};o.InvalidLineHandle={toString:function(){return"CodeMirror.InvalidLineHandle"}};o.replace=function(e){typeof e=="string"&&(e=document.getElementById(e));return function(t){e.parentNode.replaceChild(t,e)}};o.fromTextArea=function(e,t){function n(){e.value=u.getCode()}function s(t){e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t)}typeof e=="string"&&(e=document.getElementById(e));t=t||{};e.style.width&&t.width==null&&(t.width=e.style.width);e.style.height&&t.height==null&&(t.height=e.style.height);t.content==null&&(t.content=e.value);if(e.form){typeof e.form.addEventListener=="function"?e.form.addEventListener("submit",n,!1):e.form.attachEvent("onsubmit",n);var r=e.form.submit;function i(){n();e.form.submit=r;e.form.submit();e.form.submit=i}e.form.submit=i}e.style.display="none";var u=new o(s,t);u.save=n;u.toTextArea=function(){n();e.parentNode.removeChild(u.wrapping);e.style.display="";if(e.form){e.form.submit=r;typeof e.form.removeEventListener=="function"?e.form.removeEventListener("submit",n,!1):e.form.detachEvent("onsubmit",n)}};return u};o.isProbablySupported=function(){var e;return window.opera?Number(window.opera.version())>=9.52:/Apple Computer, Inc/.test(navigator.vendor)&&(e=navigator.userAgent.match(/Version\/(\d+(?:\.\d+)?)\./))?Number(e[1])>=3:document.selection&&window.ActiveXObject&&(e=navigator.userAgent.match(/MSIE (\d+(?:\.\d*)?)\b/))?Number(e[1])>=6:(e=navigator.userAgent.match(/gecko\/(\d{8})/i))?Number(e[1])>=20050901:(e=navigator.userAgent.match(/AppleWebKit\/(\d+)/))?Number(e[1])>=525:null};return o}();