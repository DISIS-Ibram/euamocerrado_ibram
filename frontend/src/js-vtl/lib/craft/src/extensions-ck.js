/**@
* #Crafty.support
* @category Misc, Core
* Determines feature support for what Crafty can do.
*/(function(){var t=Crafty.support={},n=navigator.userAgent.toLowerCase(),r=/(webkit)[ \/]([\w.]+)/.exec(n)||/(o)pera(?:.*version)?[ \/]([\w.]+)/.exec(n)||/(ms)ie ([\w.]+)/.exec(n)||/(moz)illa(?:.*? rv:([\w.]+))?/.exec(n)||[],i=/iPad|iPod|iPhone|Android|webOS|IEMobile/i.exec(n);i&&(Crafty.mobile=i[0]);t.setter="__defineSetter__"in this&&"__defineGetter__"in this;t.defineProperty=function(){if(!1 in Object)return!1;try{Object.defineProperty({},"x",{})}catch(e){return!1}return!0}();t.audio="Audio"in window;t.prefix=r[1]||r[0];t.prefix==="moz"&&(t.prefix="Moz");t.prefix==="o"&&(t.prefix="O");if(r[2]){t.versionName=r[2];t.version=+r[2].split(".")[0]}t.canvas="getContext"in document.createElement("canvas");if(t.canvas){var s;try{s=document.createElement("canvas").getContext("experimental-webgl");s.viewportWidth=t.canvas.width;s.viewportHeight=t.canvas.height}catch(o){}t.webgl=!!s}else t.webgl=!1;t.css3dtransform=typeof document.createElement("div").style.Perspective!="undefined"||typeof document.createElement("div").style[t.prefix+"Perspective"]!="undefined";t.deviceorientation=typeof window.DeviceOrientationEvent!="undefined"||typeof window.OrientationEvent!="undefined";t.devicemotion=typeof window.DeviceMotionEvent!="undefined"})();Crafty.extend({zeroFill:function(e,t){t-=e.toString().length;return t>0?(new Array(t+(/\./.test(e)?2:1))).join("0")+e:e.toString()},sprite:function(e,t,n,r,i,s){var o,u,a,f,l,c,h;if(typeof e=="string"){s=i;i=r;r=t;n=e;e=1;t=1}if(typeof t=="string"){s=i;i=r;r=n;n=t;t=e}!s&&i&&(s=i);i=parseInt(i||0,10);s=parseInt(s||0,10);h=Crafty.asset(n);if(!h){h=new Image;h.src=n;Crafty.asset(n,h);h.onload=function(){for(o in r)Crafty(o).each(function(){this.ready=!0;this.trigger("Change")})}}for(o in r){if(!r.hasOwnProperty(o))continue;u=r[o];a=u[0]*(e+i);f=u[1]*(t+s);l=u[2]*e||e;c=u[3]*t||t;Crafty.c(o,{ready:!1,__coord:[a,f,l,c],init:function(){this.requires("Sprite");this.__trim=[0,0,0,0];this.__image=n;this.__coord=[this.__coord[0],this.__coord[1],this.__coord[2],this.__coord[3]];this.__tile=e;this.__tileh=t;this.__padding=[i,s];this.img=h;if(this.img.complete&&this.img.width>0){this.ready=!0;this.trigger("Change")}this.w=this.__coord[2];this.h=this.__coord[3]}})}return this},_events:{},addEvent:function(e,t,n,r){if(arguments.length===3){r=n;n=t;t=window.document}var i=function(t){var t=t||window.event;typeof r=="function"&&r.call(e,t)},s=e[0]||"";if(!!this._events[s+t+n+r])return;this._events[s+t+n+r]=i;t.attachEvent?t.attachEvent("on"+n,i):t.addEventListener(n,i,!1)},removeEvent:function(e,t,n,r){if(arguments.length===3){r=n;n=t;t=window.document}var i=e[0]||"",s=this._events[i+t+n+r];if(s){t.detachEvent?t.detachEvent("on"+n,s):t.removeEventListener(n,s,!1);delete this._events[i+t+n+r]}},background:function(e){Crafty.stage.elem.style.background=e},viewport:{clampToEntities:!0,width:0,height:0,_x:0,_y:0,bounds:null,scroll:function(e,t){t=Math.floor(t);var n=t-this[e],r=Crafty.canvas.context,i=Crafty.stage.inner.style,s;this[e]=t;if(r){e=="_x"?r.translate(n,0):r.translate(0,n);Crafty.DrawManager.drawAll()}i[e=="_x"?"left":"top"]=t+"px"},rect:function(){return{_x:-this._x,_y:-this._y,_w:this.width,_h:this.height}},pan:function(){function r(n){var r=0;for(t in e){var s=e[t];if(s.remTime>0){s.current+=s.diff;s.remTime--;Crafty.viewport[t]=Math.floor(s.current);r++}else delete e[t]}r&&Crafty.viewport._clamp()}var e={},t,n=!1;return function(s,o,u){Crafty.viewport.follow();if(s=="reset"){for(t in e)e[t].remTime=0;return}u==0&&(u=1);e[s]={diff:-o/u,current:Crafty.viewport[s],remTime:u};if(!n){Crafty.bind("EnterFrame",r);n=!0}}}(),follow:function(){function r(){Crafty.viewport.scroll("_x",-(this.x+this.w/2-Crafty.viewport.width/2-t));Crafty.viewport.scroll("_y",-(this.y+this.h/2-Crafty.viewport.height/2-n));Crafty.viewport._clamp()}var e,t,n;return function(i,s,o){e&&e.unbind("Change",r);if(!i||!i.has("2D"))return;Crafty.viewport.pan("reset");e=i;t=typeof s!="undefined"?s:0;n=typeof o!="undefined"?o:0;i.bind("Change",r);r.call(i)}}(),centerOn:function(e,t){var n=e.x,r=e.y,i=e.w/2,s=e.h/2,o=Crafty.viewport.width/2,u=Crafty.viewport.height/2,a=n+i-o,f=r+s-u;Crafty.viewport.pan("reset");Crafty.viewport.pan("x",a,t);Crafty.viewport.pan("y",f,t)},_zoom:1,zoom:function(){function u(){if(n>0){isFinite(Crafty.viewport._zoom)&&(e=Crafty.viewport._zoom);var i={width:s.width*e,height:s.height*e};e+=t;Crafty.viewport._zoom=e;var u={width:s.width*e,height:s.height*e},a={width:u.width-i.width,height:u.height-i.height};Crafty.stage.inner.style[r]="scale("+e+","+e+")";if(Crafty.canvas._canvas){var f=e/(e-t);Crafty.canvas.context.scale(f,f);Crafty.DrawManager.drawAll()}Crafty.viewport.x-=a.width*o.width;Crafty.viewport.y-=a.height*o.height;n--}}var e=1,t=0,n=0,r=Crafty.support.prefix+"Transform",i=!1,s={},o={};return function(r,a,f,l){var c=this.bounds||Crafty.map.boundaries(),h=r?e*r:1;if(!r){e=1;this._zoom=1}s.width=c.max.x-c.min.x;s.height=c.max.y-c.min.y;o.width=a/s.width;o.height=f/s.height;l==0&&(l=1);t=(h-e)/l;n=l;Crafty.viewport.pan("reset");if(!i){Crafty.bind("EnterFrame",u);i=!0}}}(),scale:function(){var e=Crafty.support.prefix+"Transform",t={};return function(n){var r=this.bounds||Crafty.map.boundaries(),i=n?this._zoom*n:1,s=i/this._zoom;this._zoom=i;t.width=r.max.x-r.min.x;t.height=r.max.y-r.min.y;var o={width:t.width*i,height:t.height*i};Crafty.viewport.pan("reset");Crafty.stage.inner.style.transform=Crafty.stage.inner.style[e]="scale("+this._zoom+","+this._zoom+")";if(Crafty.canvas._canvas){Crafty.canvas.context.scale(s,s);Crafty.DrawManager.drawAll()}}}(),mouselook:function(){var e=!1,t=!1,n={};old={};return function(r,i){if(typeof r=="boolean"){e=r;e?Crafty.mouseObjs++:Crafty.mouseObjs=Math.max(0,Crafty.mouseObjs-1);return}if(!e)return;switch(r){case"move":case"drag":if(!t)return;diff={x:i.clientX-n.x,y:i.clientY-n.y};Crafty.viewport.x+=diff.x;Crafty.viewport.y+=diff.y;Crafty.viewport._clamp();case"start":n.x=i.clientX;n.y=i.clientY;t=!0;break;case"stop":t=!1}}}(),_clamp:function(){if(!this.clampToEntities)return;var e=this.bounds||Crafty.map.boundaries();e.max.x*=this._zoom;e.min.x*=this._zoom;e.max.y*=this._zoom;e.min.y*=this._zoom;if(e.max.x-e.min.x>Crafty.viewport.width){e.max.x-=Crafty.viewport.width;Crafty.viewport.x<-e.max.x?Crafty.viewport.x=-e.max.x:Crafty.viewport.x>-e.min.x&&(Crafty.viewport.x=-e.min.x)}else Crafty.viewport.x=-1*(e.min.x+(e.max.x-e.min.x)/2-Crafty.viewport.width/2);if(e.max.y-e.min.y>Crafty.viewport.height){e.max.y-=Crafty.viewport.height;Crafty.viewport.y<-e.max.y?Crafty.viewport.y=-e.max.y:Crafty.viewport.y>-e.min.y&&(Crafty.viewport.y=-e.min.y)}else Crafty.viewport.y=-1*(e.min.y+(e.max.y-e.min.y)/2-Crafty.viewport.height/2)},init:function(e,t){Crafty.DOM.window.init();this.width=!e||Crafty.mobile?Crafty.DOM.window.width:e;this.height=!t||Crafty.mobile?Crafty.DOM.window.height:t;var n=document.getElementById("cr-stage");Crafty.stage={x:0,y:0,fullscreen:!1,elem:n?n:document.createElement("div"),inner:document.createElement("div")};if(!e&&!t||Crafty.mobile){document.body.style.overflow="hidden";Crafty.stage.fullscreen=!0}Crafty.addEvent(this,window,"resize",Crafty.viewport.reload);Crafty.addEvent(this,window,"blur",function(){Crafty.settings.get("autoPause")&&(Crafty._paused||Crafty.pause())});Crafty.addEvent(this,window,"focus",function(){Crafty._paused&&Crafty.settings.get("autoPause")&&Crafty.pause()});Crafty.settings.register("stageSelectable",function(e){Crafty.stage.elem.onselectstart=e?function(){return!0}:function(){return!1}});Crafty.settings.modify("stageSelectable",!1);Crafty.settings.register("stageContextMenu",function(e){Crafty.stage.elem.oncontextmenu=e?function(){return!0}:function(){return!1}});Crafty.settings.modify("stageContextMenu",!1);Crafty.settings.register("autoPause",function(){});Crafty.settings.modify("autoPause",!1);if(!n){document.body.appendChild(Crafty.stage.elem);Crafty.stage.elem.id="cr-stage"}var r=Crafty.stage.elem.style,i;Crafty.stage.elem.appendChild(Crafty.stage.inner);Crafty.stage.inner.style.position="absolute";Crafty.stage.inner.style.zIndex="1";r.width=this.width+"px";r.height=this.height+"px";r.overflow="hidden";if(Crafty.mobile){r.position="absolute";r.left="0px";r.top="0px";typeof r.webkitTapHighlightColor!=undefined&&(r.webkitTapHighlightColor="rgba(0,0,0,0)");var s=document.createElement("meta"),o=document.getElementsByTagName("HEAD")[0];s.setAttribute("name","viewport");s.setAttribute("content","width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no");o.appendChild(s);s=document.createElement("meta");s.setAttribute("name","apple-mobile-web-app-capable");s.setAttribute("content","yes");o.appendChild(s);setTimeout(function(){window.scrollTo(0,1)},0);Crafty.addEvent(this,window,"touchmove",function(e){e.preventDefault()});Crafty.stage.x=0;Crafty.stage.y=0}else{r.position="relative";i=Crafty.DOM.inner(Crafty.stage.elem);Crafty.stage.x=i.x;Crafty.stage.y=i.y}if(Crafty.support.setter){this.__defineSetter__("x",function(e){this.scroll("_x",e)});this.__defineSetter__("y",function(e){this.scroll("_y",e)});this.__defineGetter__("x",function(){return this._x});this.__defineGetter__("y",function(){return this._y})}else if(Crafty.support.defineProperty){Object.defineProperty(this,"x",{set:function(e){this.scroll("_x",e)},get:function(){return this._x}});Object.defineProperty(this,"y",{set:function(e){this.scroll("_y",e)},get:function(){return this._y}})}else{this.x=this._x;this.y=this._y;Crafty.e("viewport")}},reload:function(){Crafty.DOM.window.init();var e=Crafty.DOM.window.width,t=Crafty.DOM.window.height,n;if(Crafty.stage.fullscreen){this.width=e;this.height=t;Crafty.stage.elem.style.width=e+"px";Crafty.stage.elem.style.height=t+"px";if(Crafty.canvas._canvas){Crafty.canvas._canvas.width=e;Crafty.canvas._canvas.height=t;Crafty.DrawManager.drawAll()}}n=Crafty.DOM.inner(Crafty.stage.elem);Crafty.stage.x=n.x;Crafty.stage.y=n.y},reset:function(){Crafty.viewport.pan("reset");Crafty.viewport.follow();Crafty.viewport.mouselook("stop");Crafty.viewport.scale()}},keys:{BACKSPACE:8,TAB:9,ENTER:13,PAUSE:19,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SHIFT:16,CTRL:17,ALT:18,PLUS:187,COMMA:188,MINUS:189,PERIOD:190,PULT_UP:29460,PULT_DOWN:29461,PULT_LEFT:4,PULT_RIGHT:5},mouseButtons:{LEFT:0,MIDDLE:1,RIGHT:2}});Crafty.c("viewport",{init:function(){this.bind("EnterFrame",function(){Crafty.viewport._x!==Crafty.viewport.x&&Crafty.viewport.scroll("_x",Crafty.viewport.x);Crafty.viewport._y!==Crafty.viewport.y&&Crafty.viewport.scroll("_y",Crafty.viewport.y)})}});