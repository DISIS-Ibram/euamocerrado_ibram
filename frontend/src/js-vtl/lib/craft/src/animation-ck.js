/**@
* #SpriteAnimation
* @category Animation
* @trigger AnimationEnd - When the animation finishes - { reel }
* @trigger Change - On each frame
*
* Used to animate sprites by changing the sprites in the sprite map.
*
*/function tweenEnterFrame(e){if(this._numProps<=0)return;var t,n;for(n in this._step){t=this._step[n];this[n]+=t.val;if(--t.rem==0){this[n]=t.prop;this.trigger("TweenEnd",n);this._step[n].rem<=0&&delete this._step[n];this._numProps--}}if(this.has("Mouse")){var r=Crafty.over,i=Crafty.mousePos;if(r&&r[0]==this[0]&&!this.isAt(i.x,i.y)){this.trigger("MouseOut",Crafty.lastEvent);Crafty.over=null}else if((!r||r[0]!=this[0])&&this.isAt(i.x,i.y)){Crafty.over=this;this.trigger("MouseOver",Crafty.lastEvent)}}}Crafty.c("SpriteAnimation",{_reels:null,_frame:null,_currentReelId:null,init:function(){this._reels={}},animate:function(e,t,n,r){var i,s,o,u,a,f;if(arguments.length<4&&typeof t=="number"){a=t;this._currentReelId=e;currentReel=this._reels[e];this._frame={currentReel:currentReel,numberOfFramesBetweenSlides:Math.ceil(a/currentReel.length),currentSlideNumber:0,frameNumberBetweenSlides:0,repeat:0};arguments.length===3&&typeof n=="number"&&(n===-1?this._frame.repeatInfinitly=!0:this._frame.repeat=n);f=this._frame.currentReel[0];this.__coord[0]=f[0];this.__coord[1]=f[1];this.bind("EnterFrame",this.updateSprite);return this}if(typeof t=="number"){o=this.__tile+parseInt(this.__padding[0]||0,10);u=this.__tileh+parseInt(this.__padding[1]||0,10);i=[];s=t;if(r>t)for(;s<=r;s++)i.push([s*o,n*u]);else for(;s>=r;s--)i.push([s*o,n*u]);this._reels[e]=i}else if(typeof t=="object"){s=0;i=[];r=t.length-1;o=this.__tile+parseInt(this.__padding[0]||0,10);u=this.__tileh+parseInt(this.__padding[1]||0,10);for(;s<=r;s++){f=t[s];i.push([f[0]*o,f[1]*u])}this._reels[e]=i}return this},updateSprite:function(){var e=this._frame;if(!e)return;if(this._frame.frameNumberBetweenSlides++===e.numberOfFramesBetweenSlides){var t=e.currentReel[e.currentSlideNumber++];this.__coord[0]=t[0];this.__coord[1]=t[1];this._frame.frameNumberBetweenSlides=0}if(e.currentSlideNumber===e.currentReel.length)if(this._frame.repeatInfinitly===!0||this._frame.repeat>0){this._frame.repeat&&this._frame.repeat--;this._frame.frameNumberBetweenSlides=0;this._frame.currentSlideNumber=0}else if(this._frame.frameNumberBetweenSlides===e.numberOfFramesBetweenSlides){this.trigger("AnimationEnd",{reel:e.currentReel});this.stop();return}this.trigger("Change")},stop:function(){this.unbind("EnterFrame",this.updateSprite);this.unbind("AnimationEnd");this._currentReelId=null;this._frame=null;return this},reset:function(){if(!this._frame)return this;var e=this._frame.currentReel[0];this.__coord[0]=e[0];this.__coord[1]=e[1];this.stop();return this},isPlaying:function(e){return e?this._currentReelId===e:!!this._currentReelId}});Crafty.c("Tween",{_step:null,_numProps:0,tween:function(e,t){this.each(function(){if(this._step==null){this._step={};this.bind("EnterFrame",tweenEnterFrame);this.bind("RemoveComponent",function(e){e=="Tween"&&this.unbind("EnterFrame",tweenEnterFrame)})}for(var n in e){this._step[n]={prop:e[n],val:(e[n]-this[n])/t,rem:t};this._numProps++}});return this}});