/**@
* #DOM
* @category Graphics
* Draws entities as DOM nodes, specifically `<DIV>`s.
*/Crafty.c("DOM",{_element:null,_cssStyles:null,init:function(){function e(){var e=0,t=this.__c,n="";for(e in t)n+=" "+e;n=n.substr(1);this._element.className=n}this._cssStyles={visibility:"",left:"",top:"",width:"",height:"",zIndex:"",opacity:"",transformOrigin:"",transform:""};this._element=document.createElement("div");Crafty.stage.inner.appendChild(this._element);this._element.style.position="absolute";this._element.id="ent"+this[0];this.bind("Change",function(){if(!this._changed){this._changed=!0;Crafty.DrawManager.add(this)}});this.bind("NewComponent",e).bind("RemoveComponent",e);if(Crafty.support.prefix==="ms"&&Crafty.support.version<9){this._filters={};this.bind("Rotate",function(e){var t=e.matrix,n=this._element.style,r=t.M11.toFixed(8),i=t.M12.toFixed(8),s=t.M21.toFixed(8),o=t.M22.toFixed(8);this._filters.rotation="progid:DXImageTransform.Microsoft.Matrix(M11="+r+", M12="+i+", M21="+s+", M22="+o+",sizingMethod='auto expand')"})}this.bind("Remove",this.undraw);this.bind("RemoveComponent",function(e){e==="DOM"&&this.undraw()})},getDomId:function(){return this._element.id},DOM:function(e){if(e&&e.nodeType){this.undraw();this._element=e;this._element.style.position="absolute"}return this},draw:function(){var e=this._element.style,t=this.__coord||[0,0,0,0],n={x:t[0],y:t[1]},r=Crafty.support.prefix,i=[];if(this._cssStyles.visibility!=this._visible){this._cssStyles.visibility=this._visible;this._visible?e.visibility="visible":e.visibility="hidden"}if(Crafty.support.css3dtransform)i.push("translate3d("+~~this._x+"px,"+~~this._y+"px,0)");else{if(this._cssStyles.left!=this._x){this._cssStyles.left=this._x;e.left=~~this._x+"px"}if(this._cssStyles.top!=this._y){this._cssStyles.top=this._y;e.top=~~this._y+"px"}}if(this._cssStyles.width!=this._w){this._cssStyles.width=this._w;e.width=~~this._w+"px"}if(this._cssStyles.height!=this._h){this._cssStyles.height=this._h;e.height=~~this._h+"px"}if(this._cssStyles.zIndex!=this._z){this._cssStyles.zIndex=this._z;e.zIndex=this._z}if(this._cssStyles.opacity!=this._alpha){this._cssStyles.opacity=this._alpha;e.opacity=this._alpha;e[r+"Opacity"]=this._alpha}r==="ms"&&Crafty.support.version<9&&(Crafty.support.version===8?this._filters.alpha="progid:DXImageTransform.Microsoft.Alpha(Opacity="+this._alpha*100+")":this._filters.alpha="alpha(opacity="+this._alpha*100+")");if(this._mbr){var s=this._origin.x+"px "+this._origin.y+"px";e.transformOrigin=s;e[r+"TransformOrigin"]=s;Crafty.support.css3dtransform?i.push("rotateZ("+this._rotation+"deg)"):i.push("rotate("+this._rotation+"deg)")}if(this._flipX){i.push("scaleX(-1)");r==="ms"&&Crafty.support.version<9&&(this._filters.flipX="fliph")}if(this._flipY){i.push("scaleY(-1)");r==="ms"&&Crafty.support.version<9&&(this._filters.flipY="flipv")}r==="ms"&&Crafty.support.version<9&&this.applyFilters();if(this._cssStyles.transform!=i.join(" ")){this._cssStyles.transform=i.join(" ");e.transform=this._cssStyles.transform;e[r+"Transform"]=this._cssStyles.transform}this.trigger("Draw",{style:e,type:"DOM",co:n});return this},applyFilters:function(){this._element.style.filter="";var e="";for(var t in this._filters){if(!this._filters.hasOwnProperty(t))continue;e+=this._filters[t]+" "}this._element.style.filter=e},undraw:function(){this._element&&Crafty.stage.inner.removeChild(this._element);return this},css:function(e,t){var n,r=this._element,i,s=r.style;if(typeof e=="object")for(n in e){if(!e.hasOwnProperty(n))continue;i=e[n];typeof i=="number"&&(i+="px");s[Crafty.DOM.camelize(n)]=i}else{if(!t)return Crafty.DOM.getStyle(r,e);typeof t=="number"&&(t+="px");s[Crafty.DOM.camelize(e)]=t}this.trigger("Change");return this}});try{document.execCommand("BackgroundImageCache",!1,!0)}catch(e){}Crafty.extend({DOM:{window:{init:function(){this.width=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth;this.height=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight},width:0,height:0},inner:function(e){var t=e.getBoundingClientRect(),n=t.left+(window.pageXOffset?window.pageXOffset:document.body.scrollLeft),r=t.top+(window.pageYOffset?window.pageYOffset:document.body.scrollTop),i=parseInt(this.getStyle(e,"border-left-width")||0,10)||parseInt(this.getStyle(e,"borderLeftWidth")||0,10)||0,s=parseInt(this.getStyle(e,"border-top-width")||0,10)||parseInt(this.getStyle(e,"borderTopWidth")||0,10)||0;n+=i;r+=s;return{x:n,y:r}},getStyle:function(e,t){var n;e.currentStyle?n=e.currentStyle[this.camelize(t)]:window.getComputedStyle&&(n=document.defaultView.getComputedStyle(e,null).getPropertyValue(this.csselize(t)));return n},camelize:function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})},csselize:function(e){return e.replace(/[A-Z]/g,function(e){return e?"-"+e.toLowerCase():""})},translate:function(e,t){return{x:(e-Crafty.stage.x+document.body.scrollLeft+document.documentElement.scrollLeft-Crafty.viewport._x)/Crafty.viewport._zoom,y:(t-Crafty.stage.y+document.body.scrollTop+document.documentElement.scrollTop-Crafty.viewport._y)/Crafty.viewport._zoom}}}});