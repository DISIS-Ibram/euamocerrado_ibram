Crafty.extend({audio:{sounds:{},supported:{},codecs:{ogg:'audio/ogg; codecs="vorbis"',wav:'audio/wav; codecs="1"',webma:'audio/webm; codecs="vorbis"',mp3:'audio/mpeg; codecs="mp3"',m4a:'audio/mp4; codecs="mp4a.40.2"'},volume:1,muted:!1,paused:!1,canPlay:function(){var e=this.audioElement(),t;for(var n in this.codecs){t=e.canPlayType(this.codecs[n]);t!==""&&t!=="no"?this.supported[n]=!0:this.supported[n]=!1}},audioElement:function(){return typeof Audio!="undefined"?new Audio(""):document.createElement("audio")},add:function(e,t){Crafty.support.audio=!!this.audioElement().canPlayType;if(!Crafty.support.audio)return;this.canPlay();var n,r,i;if(arguments.length===1&&typeof e=="object")for(var s in e)for(var o in e[s]){n=this.audioElement();n.id=s;n.preload="auto";n.volume=Crafty.audio.volume;i=e[s][o];r=i.substr(i.lastIndexOf(".")+1).toLowerCase();if(this.supported[r]){n.src=i;Crafty.asset(i,n);this.sounds[s]={obj:n,played:0,volume:Crafty.audio.volume}}}if(typeof e=="string"){n=this.audioElement();n.id=e;n.preload="auto";n.volume=Crafty.audio.volume;if(typeof t=="string"){r=t.substr(t.lastIndexOf(".")+1).toLowerCase();if(this.supported[r]){n.src=t;Crafty.asset(t,n);this.sounds[e]={obj:n,played:0,volume:Crafty.audio.volume}}}if(typeof t=="object")for(o in t){n=this.audioElement();n.id=e;n.preload="auto";n.volume=Crafty.audio.volume;i=t[o];r=i.substr(i.lastIndexOf(".")+1).toLowerCase();if(this.supported[r]){n.src=i;Crafty.asset(i,n);this.sounds[e]={obj:n,played:0,volume:Crafty.audio.volume}}}}},play:function(e,t,n){if(t==0||!Crafty.support.audio||!this.sounds[e])return;var r=this.sounds[e];r.volume=r.obj.volume=n||Crafty.audio.volume;r.obj.currentTime&&(r.obj.currentTime=0);this.muted&&(r.obj.volume=0);r.obj.play();r.played++;r.obj.addEventListener("ended",function(){if(r.played<t||t==-1){this.currentTime&&(this.currentTime=0);this.play();r.played++}},!0)},stop:function(e){if(!Crafty.support.audio)return;var t;if(!e)for(var n in this.sounds){t=this.sounds[n];t.obj.paused||t.obj.pause()}if(!this.sounds[e])return;t=this.sounds[e];t.obj.paused||t.obj.pause()},_mute:function(e){if(!Crafty.support.audio)return;var t;for(var n in this.sounds){t=this.sounds[n];t.obj.volume=e?0:t.volume}this.muted=e},toggleMute:function(){this.muted?this._mute(!1):this._mute(!0)},mute:function(){this._mute(!0)},unmute:function(){this._mute(!1)},pause:function(e){if(!Crafty.support.audio||!e||!this.sounds[e])return;var t=this.sounds[e];t.obj.paused||t.obj.pause()},unpause:function(e){if(!Crafty.support.audio||!e||!this.sounds[e])return;var t=this.sounds[e];t.obj.paused&&t.obj.play()},togglePause:function(e){if(!Crafty.support.audio||!e||!this.sounds[e])return;var t=this.sounds[e];t.obj.paused?t.obj.play():t.obj.pause()}}});