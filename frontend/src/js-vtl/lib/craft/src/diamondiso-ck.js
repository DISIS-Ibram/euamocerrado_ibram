Crafty.extend({diamondIso:{_tile:{width:0,height:0,r:0},_map:{width:0,height:0,x:0,y:0},_origin:{x:0,y:0},init:function(e,t,n,r){this._tile.width=parseInt(e);this._tile.height=parseInt(t)||parseInt(e)/2;this._tile.r=this._tile.width/this._tile.height;this._map.width=parseInt(n);this._map.height=parseInt(r)||parseInt(n);this._origin.x=this._map.height*this._tile.width/2;return this},place:function(e,t,n,r){var i=this.pos2px(t,n);r||(r=1);var s=0,o=0;if(e.__margin!==undefined){s=e.__margin[0];o=e.__margin[1]}e.x=i.left+s;e.y=i.top+o-e.h;e.z=i.top*r},centerAt:function(e,t){var n=this.pos2px(e,t);Crafty.viewport.x=-n.left+Crafty.viewport.width/2-this._tile.width;Crafty.viewport.y=-n.top+Crafty.viewport.height/2},area:function(e){e||(e=0);var t=Crafty.viewport.rect(),n=e*this._tile.width,r=e*this._tile.height;t._x-=this._tile.width/2+n;t._y-=this._tile.height/2+r;t._w+=this._tile.width/2+n;t._h+=this._tile.height/2+r;var i=[];for(var s=t._y,o=t._y+t._h;s<o;s+=this._tile.height/2)for(var u=t._x,a=t._x+t._w;u<a;u+=this._tile.width/2){var f=this.px2pos(u,s);i.push([~~f.x,~~f.y])}return i},pos2px:function(e,t){return{left:(e-t)*this._tile.width/2+this._origin.x,top:(e+t)*this._tile.height/2}},px2pos:function(e,t){var n=(e-this._origin.x)/this._tile.r;return{x:(t+n)/this._tile.height,y:(t-n)/this._tile.height}},polygon:function(e){e.requires("Collision");var t=0,n=0;if(e.__margin!==undefined){t=e.__margin[0];n=e.__margin[1]}var r=[[t-0,e.h-n-this._tile.height/2],[t-this._tile.width/2,e.h-n-0],[t-this._tile.width,e.h-n-this._tile.height/2],[t-this._tile.width/2,e.h-n-this._tile.height]],i=new Crafty.polygon(r);return i}}});