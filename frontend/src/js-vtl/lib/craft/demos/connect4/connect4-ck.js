window.onload=function(){function o(e){Crafty.scene("win")}function u(e){if(!t[e])return;for(var i=0;i<t[e].length;i++)if(t[e][i]==r)return i;return n}function a(e,t){return f(e,t)?!0:l(e,t)?!0:c(e,t)?!0:h(e,t)?!0:!1}function f(n,r){if(r<3)return!1;for(var i=r;i>r-4;i--)if(t[n][i]!=e)return!1;return!0}function l(n,r){var i=1;for(var s=n-1;s>=0;s--){if(t[s][r]!=e)break;i++}for(var o=n+1;o<7;o++){if(t[o][r]!=e)break;i++}return i>=4}function c(n,r){var i=1,s=r-1,o=n-1;while(s>=0&&o>=0){if(t[o][s]!=e)break;i++;s--;o--}r+=1;n+=1;while(r<6&&n<7){if(t[n][r]!=e)break;i++;r++;n++}return i>=4}function h(n,r){var i=1,s=r+1,o=n-1;while(s<6&&o>=0){if(t[o][s]!=e)break;i++;s++;o--}r-=1;n+=1;while(r>=0&&n<7){if(t[n][r]!=e)break;i++;r--;n++}return i>=4}Crafty.init(600,500);Crafty.canvas.init();Crafty.sprite(64,"images/sprite.png",{red:[0,0],yellow:[1,0],empty:[2,0]});var e=0,t=[],n=-2,r=-1,i=0,s=1;Crafty.scene("game",function(){function l(r){var i=u(r);if(i!==n&&r>=0&&r<7){t[r][i]=e;if(a(r,i)){o(e);return}e^=1;f=Crafty.e("2D, Canvas, piece, stopper,"+(e?"red":"yellow")).attr({x:495,y:420})}else{var s=f.x,l=f.y;f.destroy();f=Crafty.e("2D, Canvas, piece, stopper,"+(e?"red":"yellow")).attr({x:s,y:l}).tween({x:495,y:420},20)}}for(var i=0;i<7;i++){t[i]=[];for(var s=0;s<6;s++){Crafty.e("2D, Canvas, empty").attr({x:i*64,y:s*64+100,z:2});t[i][s]=r}}Crafty.c("piece",{init:function(){this.z=3;this.requires("Mouse, Gravity, Draggable, Tween");this.bind("StopDrag",function(){var e=Math.round(this._x/64);this.tween({x:e*64},20);this.gravity("stopper");this.unbind("MouseDown");l(e)})}});var f;f=Crafty.e("2D, Canvas, piece, stopper, yellow").attr({x:495,y:420});var c=Crafty.e("2D, stopper").attr({y:Crafty.viewport.height-16,w:Crafty.viewport.width,h:20}),h=Crafty.e("2D, Canvas, Image").image("images/bg.png").attr({z:-1})});Crafty.scene("win",function(){var t=Crafty.e("2D, DOM, Image").image("images/win.png","no-repeat").attr({w:600,h:500,z:-1});Crafty.e("2D, DOM, Text").attr({x:220,y:200}).text(e?"RED":"YELLOW").css({"font-family":"Arial","font-size":"30pt"})});Crafty.scene("game")};