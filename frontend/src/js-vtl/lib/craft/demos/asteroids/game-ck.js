$(document).ready(function(){Crafty.init();Crafty.canvas.init();Crafty.load(["images/sprite.png","images/bg.png"],function(){Crafty.sprite(64,"images/sprite.png",{ship:[0,0],big:[1,0],medium:[2,0],small:[3,0]});Crafty.audio.add("Blaster",["space-blaster.wav","space-blaster.mp3"]);Crafty.scene("main")});Crafty.scene("main",function(){function i(e,t){var i=Crafty.math.randomInt(e,t);n=i;r=i;for(var s=0;s<i;s++)Crafty.e("2D, DOM, big, Collision, asteroid")}Crafty.background("url('images/bg.png')");var e=Crafty.e("2D, DOM, Text").text("Score: 0").attr({x:Crafty.viewport.width-300,y:Crafty.viewport.height-50,w:200,h:50}).css({color:"#fff"}),t=Crafty.e("2D, Canvas, ship, Controls, Collision").attr({move:{left:!1,right:!1,up:!1,down:!1},xspeed:0,yspeed:0,decay:.9,x:Crafty.viewport.width/2,y:Crafty.viewport.height/2,score:0}).origin("center").bind("KeyDown",function(e){if(e.keyCode===Crafty.keys.RIGHT_ARROW)this.move.right=!0;else if(e.keyCode===Crafty.keys.LEFT_ARROW)this.move.left=!0;else if(e.keyCode===Crafty.keys.UP_ARROW)this.move.up=!0;else if(e.keyCode===Crafty.keys.SPACE){console.log("Blast");Crafty.audio.play("Blaster");Crafty.e("2D, DOM, Color, bullet").attr({x:this._x,y:this._y,w:2,h:5,rotation:this._rotation,xspeed:20*Math.sin(this._rotation/57.3),yspeed:20*Math.cos(this._rotation/57.3)}).color("rgb(255, 0, 0)").bind("EnterFrame",function(){this.x+=this.xspeed;this.y-=this.yspeed;(this._x>Crafty.viewport.width||this._x<0||this._y>Crafty.viewport.height||this._y<0)&&this.destroy()})}}).bind("KeyUp",function(e){e.keyCode===Crafty.keys.RIGHT_ARROW?this.move.right=!1:e.keyCode===Crafty.keys.LEFT_ARROW?this.move.left=!1:e.keyCode===Crafty.keys.UP_ARROW&&(this.move.up=!1)}).bind("EnterFrame",function(){this.move.right&&(this.rotation+=5);this.move.left&&(this.rotation-=5);var e=Math.sin(this._rotation*Math.PI/180)*.3,t=Math.cos(this._rotation*Math.PI/180)*.3;if(this.move.up){this.yspeed-=t;this.xspeed+=e}else{this.xspeed*=this.decay;this.yspeed*=this.decay}this.x+=this.xspeed;this.y+=this.yspeed;this._x>Crafty.viewport.width&&(this.x=-64);this._x<-64&&(this.x=Crafty.viewport.width);this._y>Crafty.viewport.height&&(this.y=-64);this._y<-64&&(this.y=Crafty.viewport.height);n<=0&&i(r,r*2)}).collision().onHit("asteroid",function(){Crafty.scene("main")}),n,r;Crafty.c("asteroid",{init:function(){this.origin("center");this.attr({x:Crafty.math.randomInt(0,Crafty.viewport.width),y:Crafty.math.randomInt(0,Crafty.viewport.height),xspeed:Crafty.math.randomInt(1,5),yspeed:Crafty.math.randomInt(1,5),rspeed:Crafty.math.randomInt(-5,5)}).bind("EnterFrame",function(){this.x+=this.xspeed;this.y+=this.yspeed;this.rotation+=this.rspeed;this._x>Crafty.viewport.width&&(this.x=-64);this._x<-64&&(this.x=Crafty.viewport.width);this._y>Crafty.viewport.height&&(this.y=-64);this._y<-64&&(this.y=Crafty.viewport.height)}).collision().onHit("bullet",function(r){t.score+=5;e.text("Score: "+t.score);r[0].obj.destroy();var i;if(this.has("big")){this.removeComponent("big").addComponent("medium");i="medium"}else if(this.has("medium")){this.removeComponent("medium").addComponent("small");i="small"}else if(this.has("small")){n--;this.destroy();return}var s=this.xspeed;this.xspeed=-this.yspeed;this.yspeed=s;n++;Crafty.e("2D, DOM, "+i+", Collision, asteroid").attr({x:this._x,y:this._y})})}});i(1,10)})});